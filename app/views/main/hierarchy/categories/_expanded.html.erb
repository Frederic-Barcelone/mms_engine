<% if margin_depth.nil?
     margin_depth = expanded.ancestors.size
   end %>
<%= Util::MARGIN * margin_depth %>
<% children = expanded.children.select{|element| element.count_inherited_media > 0 }
   element_path = "#{controller.controller_name.singularize}_path"
   expanded_div = "#{expanded.id}_div"
   if children.empty? %>
     &#9674;
<% else %>
<%=  link_to_remote '-', { :update => expanded_div, :url => self.send("contract_#{element_path}", expanded, :margin_depth => margin_depth), :method => 'get' }, { :class => 'collapsable' } %>
<% end
   selected = !@element.nil? && (expanded.id == @element.id.to_i)
   if selected %>
     <span class="selected_branch">
<% end %>
<%= "#{link_to_remote h(expanded.title).s, :url => self.send(element_path, expanded, :margin_depth => margin_depth), :method => 'get', :loading => loading_animation_script(expanded_div), :loaded => reset_animation_script(expanded_div)} (#{expanded.count_inherited_media})" %>
<% if selected %>
     </span>
<% end %>
<br/>
<%= render :partial => 'main/hierarchy/categories/category_index', :locals => {:margin_depth => margin_depth+1, :elements => children} %>