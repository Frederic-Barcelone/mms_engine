<% if margin_depth.nil?
     margin_depth = expanded.ancestors.size
   end %>
<%= Util::MARGIN * margin_depth %>
<% children = expanded.children.select{|element| element.media_count > 0 }
   if children.empty? %>
     &#9674;
<% else %>
<%=  link_to_remote '-', { :update => "#{expanded.id}_div", :url => contract_topic_path(expanded, :margin_depth => margin_depth), :method => 'get' }, { :class => 'collapsable' } %>
<% end
   selected = !@topic.nil? && (expanded.id == @topic.id.to_i)
   if selected %>
     <span class="selected_branch">
<% end %>
<%= "#{link_to h(expanded.title).s, expanded} (#{number_with_delimiter(expanded.media_count, :delimiter => ',')})" %>
<% if selected %>
     </span>
<% end %>
<br/>
<%= render :partial => 'topics_index', :locals => {:margin_depth => margin_depth+1, :topics => children} %>